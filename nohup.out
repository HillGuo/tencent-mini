2017-07-11 22:11:36,609 - web.py[line:2063] - INFO: 200 POST /login (59.37.125.37) 0.82ms
2017-07-11 22:35:02,499 - web.py[line:2063] - INFO: 200 POST /login (59.37.125.37) 0.55ms
2017-07-12 02:12:52,906 - web.py[line:2063] - WARNING: 404 GET / (47.93.112.232) 0.55ms
2017-07-12 10:14:05,435 - web.py[line:2063] - WARNING: 404 GET / (59.110.6.177) 0.48ms
2017-07-12 10:53:25,641 - web.py[line:1590] - ERROR: Uncaught exception POST /login (14.17.22.34)
HTTPServerRequest(protocol='http', host='123.206.212.82:8000', method='POST', uri='/login', version='HTTP/1.1', remote_ip='14.17.22.34', headers={'Cookie': '_token="2|1:0|10:1499580914|6:_token|44:YzQ3Y2NkYTg5YjJkZDc4ZjI0ZDVhZGE4OTljNTI4MGM=|979e632019fa3ae0f734e45182ac1ffd7c292b7a315d0693b4799a394a1f092f"', 'Content-Type': 'multipart/form-data; boundary=----WebKitFormBoundaryk2CNhgbYPene8KuF', 'Connection': 'keep-alive', 'Origin': 'chrome-extension://fhbjgbiflinjbdggehcddcbncdddomop', 'Accept-Encoding': 'gzip, deflate', 'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36', 'Host': '123.206.212.82:8000', 'Content-Length': '488', 'Cache-Control': 'no-cache, max-age=259200', 'Accept': '*/*', 'Accept-Language': 'zh-CN,zh;q=0.8,en;q=0.6', 'Postman-Token': '1a213f6a-d135-cfb0-be65-8aa768ffa43a'})
Traceback (most recent call last):
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/connections.py", line 1039, in _write_bytes
    self._sock.sendall(data)
BrokenPipeError: [Errno 32] Broken pipe

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1182, in _execute_context
    context)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/default.py", line 470, in do_execute
    cursor.execute(statement, parameters)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/cursors.py", line 166, in execute
    result = self._query(query)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/connections.py", line 855, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/connections.py", line 1092, in _execute_command
    self._write_bytes(packet)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/connections.py", line 1044, in _write_bytes
    "MySQL server has gone away (%r)" % (e,))
pymysql.err.OperationalError: (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/ubuntu/py3/lib/python3.5/site-packages/tornado/web.py", line 1509, in _execute
    result = method(*self.path_args, **self.path_kwargs)
  File "/home/ubuntu/github/mini/handler/login_handler.py", line 28, in post
    user=self.db.query(User).filter(User.userId==user_id).first()
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/orm/query.py", line 2755, in first
    ret = list(self[0:1])
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/orm/query.py", line 2547, in __getitem__
    return list(res)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/orm/query.py", line 2855, in __iter__
    return self._execute_and_instances(context)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/orm/query.py", line 2878, in _execute_and_instances
    result = conn.execute(querycontext.statement, self._params)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 945, in execute
    return meth(self, multiparams, params)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/sql/elements.py", line 263, in _execute_on_connection
    return connection._execute_clauseelement(self, multiparams, params)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1053, in _execute_clauseelement
    compiled_sql, distilled_params
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1189, in _execute_context
    context)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1402, in _handle_dbapi_exception
    exc_info
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/util/compat.py", line 203, in raise_from_cause
    reraise(type(exception), exception, tb=exc_tb, cause=cause)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/util/compat.py", line 186, in reraise
    raise value.with_traceback(tb)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1182, in _execute_context
    context)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/default.py", line 470, in do_execute
    cursor.execute(statement, parameters)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/cursors.py", line 166, in execute
    result = self._query(query)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/connections.py", line 855, in query
    self._execute_command(COMMAND.COM_QUERY, sql)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/connections.py", line 1092, in _execute_command
    self._write_bytes(packet)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/pymysql/connections.py", line 1044, in _write_bytes
    "MySQL server has gone away (%r)" % (e,))
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2006, "MySQL server has gone away (BrokenPipeError(32, 'Broken pipe'))") [SQL: 'SELECT user.`userId` AS `user_userId`, user.`userName` AS `user_userName`, user.`userAvatar` AS `user_userAvatar` \nFROM user \nWHERE user.`userId` = %(userId_1)s \n LIMIT %(param_1)s'] [parameters: {'userId_1': 'fdsdsfds01', 'param_1': 1}]
2017-07-12 10:53:25,645 - web.py[line:2063] - ERROR: 500 POST /login (14.17.22.34) 10.01ms
2017-07-12 10:53:35,149 - web.py[line:1590] - ERROR: Uncaught exception POST /login (14.17.22.34)
HTTPServerRequest(protocol='http', host='123.206.212.82:8000', method='POST', uri='/login', version='HTTP/1.1', remote_ip='14.17.22.34', headers={'Cookie': '_token="2|1:0|10:1499580914|6:_token|44:YzQ3Y2NkYTg5YjJkZDc4ZjI0ZDVhZGE4OTljNTI4MGM=|979e632019fa3ae0f734e45182ac1ffd7c292b7a315d0693b4799a394a1f092f"', 'Content-Type': 'multipart/form-data; boundary=----WebKitFormBoundaryql3RtLmxXr8t7VSe', 'Connection': 'keep-alive', 'Origin': 'chrome-extension://fhbjgbiflinjbdggehcddcbncdddomop', 'Accept-Encoding': 'gzip, deflate', 'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36', 'Host': '123.206.212.82:8000', 'Content-Length': '486', 'Cache-Control': 'no-cache, max-age=259200', 'Accept': '*/*', 'Accept-Language': 'zh-CN,zh;q=0.8,en;q=0.6', 'Postman-Token': '0e6f9e65-baa6-98f6-3462-2677c12281fc'})
Traceback (most recent call last):
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1112, in _execute_context
    conn = self.__connection
AttributeError: 'Connection' object has no attribute '_Connection__connection'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1114, in _execute_context
    conn = self._revalidate_connection()
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 424, in _revalidate_connection
    "Can't reconnect until invalid "
sqlalchemy.exc.InvalidRequestError: Can't reconnect until invalid transaction is rolled back

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/ubuntu/py3/lib/python3.5/site-packages/tornado/web.py", line 1509, in _execute
    result = method(*self.path_args, **self.path_kwargs)
  File "/home/ubuntu/github/mini/handler/login_handler.py", line 28, in post
    user=self.db.query(User).filter(User.userId==user_id).first()
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/orm/query.py", line 2755, in first
    ret = list(self[0:1])
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/orm/query.py", line 2547, in __getitem__
    return list(res)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/orm/query.py", line 2855, in __iter__
    return self._execute_and_instances(context)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/orm/query.py", line 2878, in _execute_and_instances
    result = conn.execute(querycontext.statement, self._params)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 945, in execute
    return meth(self, multiparams, params)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/sql/elements.py", line 263, in _execute_on_connection
    return connection._execute_clauseelement(self, multiparams, params)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1053, in _execute_clauseelement
    compiled_sql, distilled_params
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1121, in _execute_context
    None, None)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1402, in _handle_dbapi_exception
    exc_info
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/util/compat.py", line 203, in raise_from_cause
    reraise(type(exception), exception, tb=exc_tb, cause=cause)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/util/compat.py", line 186, in reraise
    raise value.with_traceback(tb)
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 1114, in _execute_context
    conn = self._revalidate_connection()
  File "/home/ubuntu/py3/lib/python3.5/site-packages/sqlalchemy/engine/base.py", line 424, in _revalidate_connection
    "Can't reconnect until invalid "
sqlalchemy.exc.StatementError: (sqlalchemy.exc.InvalidRequestError) Can't reconnect until invalid transaction is rolled back [SQL: 'SELECT user.`userId` AS `user_userId`, user.`userName` AS `user_userName`, user.`userAvatar` AS `user_userAvatar` \nFROM user \nWHERE user.`userId` = %(userId_1)s \n LIMIT %(param_1)s'] [parameters: [{}]]
2017-07-12 10:53:35,150 - web.py[line:2063] - ERROR: 500 POST /login (14.17.22.34) 2.63ms
